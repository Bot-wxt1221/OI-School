手玩后发现最终形态是一些极大矩形。

当两个矩形的曼哈顿距离 $\le 2$ 时可以合并成一个大矩形。

对于一个矩形，考虑找出 **有用的可能合并** 的点，并判断其所在矩形是否合法。

发现 **有用的** 点只有 $O(1)$ 个。具体来说，以往右为例，**有用的** 点为：往右 1/2 列，往上第 1 个和往下第 1 个的点。其余三个方向同理。

对于一个矩形，找出所有 **有用的** 点并判断是否合法即可。

最后可能有一些包含关系的矩形没有合并。处理一下即可。

时间复杂度 $O(n\log n)$ 。可以做到 $O(n)$ 但常数很大。

---

验题人做法：

考虑对于 $x$ 轴扫描线，用线段树维护离当前 $x$ 轴最近的矩形的右边界。

查询时找到 $y$ 坐标在可合并范围的最近的矩形并判断是否可以合并即可。

时间复杂度 $O(n\log n)$ 。
