## V

记要判断的串长为 $n$，首先先判断 `(` 和 `)` 是否各 $n/2$ 个，若不然则答案为 `No`。然后贪心地取前 $n/4$ 个 `(` 和后 $n/4$ 个 `)` 组成一个子序列，判断它是否合法以及剩下的那个子序列取反后是否合法。容易证明如果原串是好的当且仅当这样取出来的子序列满足条件。
    
## U

建图跑最短路，可以只保留那 $C$ 个石砖，这样它们之间至多 $4C$ 条边，对于冰砖上的询问可以枚举它初始往哪个方向滑然后通过第一个碰到的石砖求出答案。

考虑到速度会变，所以要在每个状态下加一维表示当前速度，显然每个石砖至多只会经过一次所以那一维大小为 $O(C)$。这样总点数总边数都是 $O(C^2)$ 的，而且这关于速度那维是个分层图，于是这就只用求个 DAG 上最短路，总复杂度 $O(HW+C^2)$。

## T

不妨先将 $A$ 降序排序，则有个显然但关键的性质 $A_1+1\ge A_2+2\ge\cdots\ge A_N+N$。

然后是一大堆分类讨论。

当 $P=1$ 时：

- $(1,2,3)$ 显然合法。
- $(1,2,x)(3<x)$ 合法当且仅当 $A_x+N\ge A_3+1$。
- $(1,x,y)(2<y<x)$ 合法当且仅当 $A_y+N\ge A_2+1$。
- $(x,y,z)(1<x<y<z)$ 合法当且仅当 $A_z+N\ge A_1+1$。

均可以线性统计答案。

当 $P=2$ 时：

- $(1,x,2)(2<x)$ 合法当且仅当 $A_x+N\ge A_2+1$。
- $(1,x,y)(2<y<x)$ 合法当且仅当 $A_x+N\ge A_2+1$。
- $(x,y,z)(1<x<z<y)$ 合法当且仅当 $A_y+N\ge A_1+1$。

均可以线性统计答案。

以下对 $P=2$ 时的第一种情况进行证明，剩下情况的证明是类似的：

记 $B$ 为每个人第二天的得分（与排好序的 $A$ 对应），$C$ 为两天总分。先令 $B=(N,1,2\ldots,N-1)$，此时有 $C_1\ge C_2\ge\ldots C_N$。然后考虑 $i=A_2+1-A_x\ge x$，若 $i<N$ 则交换 $B_x$ 与 $B_{i+1}$，此时 $C_1\ge C_x\ge C_2\ge \text{others}$（因为 $C_{i+1}$ 变小了而其它不为 $x$ 的 $C$ 不变）。若 $i=N$ 则先交换 $B_N$ 与 $B_1$ 再交换 $B_x$ 与 $B_N$ 则满足条件。

## S

核心思想是将每个区间的贡献放到这个区间还未变成 $0$ 的最大 $a_i$ 上。具体地，考虑以下过程：从大到小枚举每个 $a_i$，如果选择将它变为 $0$ 就继续，否则取出跨过 $i$ 的区间，每取出一个就给最终贡献 $+a_i$ 然后将这个区间删掉。目标就是在至多进行 $M$ 次置 $0$ 操作时最小化总贡献。

这个过程看着就很区间 dp，记 $f_{i,j,l,r}$ 表示从大到小枚举的上一个 $a$ 是 $a_i$，还剩 $j$ 次变 $0$ 操作可用，只考虑计算被 $[l,r]$ 包含的区间的贡献，的最小总贡献。转移时设 $k$ 为 $[l,r]$ 中 $<a_i$（离散化后）的最大值，那么当前考虑 $a_k$：

- 若把它变 $0$，就从 $f_{k,j-1,l,r}$ 转移。
- 否则计算完 $a_k$ 对答案的贡献后递归到 $[l,k-1]$ 和 $[k+1,r]$ 考虑。具体地，枚举左右分别变 $0$ 的次数，从 $a_k\times\#+\min_{0\le t\le j}\{f_{k,t,l,k-1}+f_{k,j-t,k+1,r}\}$ 转移。其中 $\#$ 为满足 $l\le l_i\le k\le r_i\le r$ 的区间 $[l_i,r_i]$ 个数。

边界条件容易得出。最终答案为 $f_{N+1,M,1,N}$，其中 $a_{N+1}$ 认为比所有 $a_i(1\le i\le N)$ 都大。

时间复杂度 $O(N^5+N^3Q)$，常数很小。